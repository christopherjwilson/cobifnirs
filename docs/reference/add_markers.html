<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add markers to NIRS data — add_markers • cobifnirs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Add markers to NIRS data — add_markers"><meta property="og:description" content="This function will add markers to the NIRS data. The data must be the format generated using import_nirs and markers must be in the COBI .mrk file with the exact same name and location as the original .nir file. The returned data will have the markers added as a new column. If there are duplicate markers (i.e. more than one marker sent within a 500ms window), the function will either allow duplicates or remove them, depending on the parameters set."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cobifnirs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/christopherjwilson/cobifnirs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add markers to NIRS data</h1>
    <small class="dont-index">Source: <a href="https://github.com/christopherjwilson/cobifnirs/blob/HEAD/R/add_markers.R" class="external-link"><code>R/add_markers.R</code></a></small>
    <div class="hidden name"><code>add_markers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function will add markers to the NIRS data. The data must be the format generated using <code><a href="import_nirs.html">import_nirs</a></code> and markers must be in the COBI .mrk file with the exact same name and location as the original .nir file. The returned data will have the markers added as a new column. If there are duplicate markers (i.e. more than one marker sent within a 500ms window), the function will either allow duplicates or remove them, depending on the parameters set.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_markers</span><span class="op">(</span><span class="va">nirsData</span>, allowDuplicates <span class="op">=</span> <span class="cn">FALSE</span>, removeDuplicates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>nirsData</dt>
<dd><p>(DATAFRAME) A dataframe containing NIRS data in a long format that has been imported using the <code><a href="import_nirs.html">import_nirs</a></code> function.</p></dd>


<dt>allowDuplicates</dt>
<dd><p>(LOGICAL: optional) If TRUE, the function will allow multiple markers to be attached to the same data point in the data. This will cause extra rows in the output (see details). Default is FALSE.</p></dd>


<dt>removeDuplicates</dt>
<dd><p>(LOGICAL: optional) If TRUE, the function will remove duplicate markers that are attached to the exact same timepoint in the data, retaining only the first marker value for that particular data point. Default is FALSE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A dataframe with the markers added as a new column.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function will add markers to the NIRS data. The data must be the format generated using <code><a href="import_nirs.html">import_nirs</a></code> and markers must be in the COBI .mrk file with the exact same name and location as the original .nir file. The returned data will have the markers added as a new column.</p>
<p><strong>How are markers added to the NIRS data?</strong></p>
<p>In real time, the markers are often sent in-between the data acquisition points. However, the COBI marker (.mrk) file specifies which data point the marker should be attached to using a row value, which is the equivalent of the dataRow value in the NIRS data generated by <code><a href="import_nirs.html">import_nirs</a></code>. This function will add the markers to the NIRS data by linking the value specified in the .mrk file to the dataRow value in the nirsData.</p>
<p><strong>Dealing with duplicate markers:</strong></p>
<p>I have found that when sending markers via a serial port connection, there is the possibility of sending duplicate markers. This happens if they are sent in quick succession, faster than the sampling rate of the fNIRS data acquisition. The result is more than one marker attached to the same data point in the original .mrk file -  (You can see this by opening the .mrk file in a text editor and looking at the 3rd column for duplicate values).</p>
<p>Often, duplicates are not useful. However, it is also possible that the markers are sent at the same time intentionally, for example, marking the end of a trial and the start of the next trial. In this case, you may want to keep the duplicate markers.</p>
<p>The allowDuplicates and removeDuplicates parameters allow you to choose how to handle duplicate markers.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="import_nirs.html">import_nirs</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># import the NIRS data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">nirsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_nirs.html">import_nirs</a></span><span class="op">(</span><span class="st">"path/to/nirs/file.nir"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The location of the marker file will be read</span></span></span>
<span class="r-in"><span><span class="co"># from the fileName column of the nirsData dataframe.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nirsData</span> <span class="op">&lt;-</span> <span class="fu">add_markers</span><span class="op">(</span><span class="va">nirsData</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let's assume there are duplicate values in the marker file.</span></span></span>
<span class="r-in"><span><span class="co"># This could be problematic if it is unintentional.</span></span></span>
<span class="r-in"><span><span class="co"># Equally, it could be completely fine for you if you are aware of this or did it intentionally.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you run the function normally, it will return a message</span></span></span>
<span class="r-in"><span><span class="co"># to let you know that there are duplicates.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We have 2 options: allow the duplicates or remove them.</span></span></span>
<span class="r-in"><span><span class="co"># If we allow them, the output will have extra rows.</span></span></span>
<span class="r-in"><span><span class="co"># These will be exact duplicates of the rows that have the same dataRow value (i.e. the same timepoint) but with the additional markers.</span></span></span>
<span class="r-in"><span><span class="co"># You might want this, and it might cause no issues with your analysis.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To allow duplicates, set allowDuplicates = TRUE.</span></span></span>
<span class="r-in"><span><span class="va">nirsData</span> <span class="op">&lt;-</span> <span class="fu">add_markers</span><span class="op">(</span><span class="va">nirsData</span>, allowDuplicates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If we remove the duplicates, we will retain only the first marker value for that particular datapoint.</span></span></span>
<span class="r-in"><span><span class="co"># This is will mean that only one of the markers will be linked to this exact datapoint.</span></span></span>
<span class="r-in"><span><span class="co"># This might be useful if you are only interested in the first marker that was sent, or if you sent additional markers accidentally.</span></span></span>
<span class="r-in"><span><span class="co"># The output will have the same number of rows as the input.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#To remove duplicates, set removeDuplicates = TRUE.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nirsData</span> <span class="op">&lt;-</span> <span class="fu">add_markers</span><span class="op">(</span><span class="va">nirsData</span>, removeDuplicates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christopher J Wilson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

